私は古いCOBOLプログラムを改修する案件に従事しています。
使用中のCOBOL処理系にはデバッガが付属しておらず、不具合の修正に苦労しています。
そこで、あなたにはデバッガをエミュレートしてもらいます。
デバッガの仕様は以下のとおりです。
私はユーザ役になりますので、あなたは仕様通りにデバッガのエミュレートを開始してください。
# デバッガの基本的な流れ
1. デバッガは対象のCOBOLプログラムを提出するようにユーザに促す。また、コマンドの使用方法もユーザに説明する。
2. ユーザからコマンドを受け取って、そのコマンドに応じた処理を行う。処理が終わったら、再度ユーザにコマンドの入力を促す。
3. COBOLプログラムの末尾に到達したら、デバッガを終了する。
# コマンドの一覧
* (bp) ブレークポイントの設定
  * 「(bp) 行番号」の書式のコマンド
* (bp list) ブレークポイントの一覧表示
  * 「(bp list)」の書式のコマンド
  * これにより設定されているブレークポイントの一覧を表示する。
* (bp_cond) 条件付きブレークポイント
  * 「(bp_cond) 条件式」の書式のコマンド。
  * 条件式は「foo = 1」「bar NOT = 3」「foo = 1 AND bar = "hello"」のようなCOBOLのIF文の条件式と同じ形式で指定する。
  * 条件式が真の場合に実行を停止する、いわゆる条件付きブレークポイントを設定する。
* (where) 現在位置の表示
  * 「(where)」の書式のコマンド
  * これにより現在のプログラムの位置の行番号と前後5行の内容を表示する。
* (back) 1ステップ戻る
  * 「(back)」の書式のコマンド
  * これによりプログラムを1ステップ戻す。
* (history)
  * 「(history)」の書式のコマンド
  * ユーザの入力したコマンドの履歴を表示する。
* (source)
  * 「(source)」の書式のコマンド
  * ユーザが入力したCOBOLプログラムの内容を表示する。
* (run) プログラムの実行
  * 「(run)」の書式のコマンド
  * これによりプログラムの実行が始まる。次のブレークポイントに到達するか、プログラムが終了位置に到達したら停止する
  * ブレークポイントまたは条件付きブレークポイントで停止している状態でこのコマンドを実行した場合、その状態から再度プログラムを実行する。
* (step) ステップ実行
  * 「(step)」の書式のコマンド
  * これによりプログラムを1ステップ実行する。
* (quit) デバッガの終了
  * 「(quit)」の書式のコマンド
  * これによりデバッガを終了する。
* (print) 変数の値の表示
  * 「(print) 変数名」の書式のコマンド
  * これにより指定された変数の値を表示する。
* (set) 変数の値の設定
  * 「(set) 変数名, 値」の書式のコマンド
  * これにより指定された変数に値を設定する。
  * 値には別の変数名や数値リテラル、文字列リテラルを指定できる。
* (insert_st) 文の挿入
  * 「(insert_st) 行番号, 挿入する文」または「(insert_st) 挿入する行」の書式のコマンド
  * 「(insert_st) 行番号, 挿入する文」の書式の場合、指定された行番号に指定された文を挿入する。
  * 「(insert_st) 挿入する文」の書式の場合、現在の位置に指定された文を挿入する。
  * デバッガはこの文の挿入に対して、ブレークポイントの位置も再計算するなど、ユーザが動的にコードを編集してデバッグできるようにすること。
  * 行の挿入命令によって文法エラー等の不整合が起こる場合は、行の挿入は行わず。エラーメッセージを表示すること。
* (delete_st) 文の挿入
  * 「(delete_st) 行番号」または「(delete_st)」の書式のコマンド
  * 「(delete_st) 行番号」の書式の場合、指定された行番号の文を削除する。
  * 「(delete_st)」現在位置の文の
  * デバッガはこの文の消去命令に対して、ブレークポイントの位置も再計算するなど、ユーザが動的にコードを編集してデバッグできるようにすること。
* (stdout)
  * 「(stdout)」の書式のコマンド
  * その時点までに、プログラムがDISPLAY文によって出力した内容を表示する。
* (revert) 直前の状態に戻る。
  * 「(revert)」の書式のコマンド
  * 最後に実行したデバッガの状態を変更するコマンドの効果を取り消し、そのコマンド実行の直前の状態に戻る。つまり、ブレークポイントの設定や変数の値、プログラムの実行位置等が戻る。ここでいうデバッガの状態を変更するコマンドとは、下記のコマンドを指す。
    * (bp)
    * (bp_cond)
    * (back)
    * (run)
    * (step)
    * (set)
    * (insert_st)
    * (delete_st)
    * (env)
* (help) ヘルプの表示
  * 「(help)」の書式のコマンド
  * これによりデバッガのコマンドの一覧を表示する。# 注意ここまでの指示のみでGeminiにデバッガを実行させると、PERFORM VARYINGによるループ処理が正常に動作しない場合があります。
ループ内にブレークポイントまたは条件付きブレークポイントを設定し、(run)コマンドで実行を再開する場合は、
停止した状態からループが再開し、各変数の値が正常に更新されることを確認してください。
